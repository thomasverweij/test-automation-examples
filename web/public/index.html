<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Automation Examples</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="page-light">
    <div class="container dashboard">
        <header class="header">
            <h1>ðŸ§ª Test Automation Examples</h1>
            <div class="user-info">
                <div class="user-details">
                    <div class="user-name" id="authUserLabel">Welcome</div>
                    <small class="muted" id="authStatusLabel">You are logged in</small>
                </div>
                <a href="/login" class="primary-link" id="loginBtn">Login</a>
                <a href="/logout" class="logout-btn hidden" id="logoutBtn">Logout</a>
            </div>
        </header>

        <div id="authSection" class="auth-section" style="margin-bottom: 20px; text-align: left;">
            <p><strong>Demo Credentials</strong></p>
            <p>ðŸ‘¤ user1 / password1 (requires 2FA)</p>
            <p>ðŸ‘¤ user2 / password2 (no 2FA)</p>
            <p class="note-text">Note: 2FA codes are logged to the server console for testing</p>
        </div>

        <div class="section">
            <h2 class="section-title dashboard">API Testing Endpoints</h2>
            <div class="card">
                <h3>GET /api/data</h3>
                <p>Returns a simple JSON response with some test data.</p>
                <button class="primary-link" id="btn-api-data" type="button">Try Request</button>
                <div id="resp-api-data" class="response-box"></div>
            </div>
            <div class="card">
                <h3>GET /api/unreliable</h3>
                <p>Randomly returns a 500 error or a successful response (50/50 chance).</p>
                <button class="primary-link" id="btn-api-unreliable" type="button">Try Request</button>
                <div id="resp-api-unreliable" class="response-box"></div>
            </div>
            <div class="card">
                <h3>GET /api/slow</h3>
                <p>Returns a response after a random delay of 1-6 seconds.</p>
                <button class="primary-link" id="btn-api-slow" type="button">Try Request</button>
                <div id="resp-api-slow" class="response-box"></div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title dashboard">Locator Examples</h2>

            <!-- CSS SELECTORS SECTION -->
            <div class="card">
                <h3>CSS Selectors</h3>
                <div class="elements-grid">
                    <div class="element-card">
                        <div class="element-label">ID Selector</div>
                        <button id="css-id-button">Click Me (ID)</button>
                        <div class="dynamic-content" id="css-id-content">âœ“ Found by ID: css-id-button</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Class Selector</div>
                        <button class="css-class-button">Click Me (Class)</button>
                        <div class="dynamic-content" id="css-class-content">âœ“ Found by Class: css-class-button</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Attribute Selector</div>
                        <button data-testid="css-attr-button">Click Me (Attr)</button>
                        <div class="dynamic-content" id="css-attr-content">âœ“ Found by data-testid attribute</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Descendant Selector</div>
                        <div class="css-parent">
                            <span id="css-nested-span">Parent > Child</span>
                        </div>
                        <button onclick="document.getElementById('css-descendant-content').classList.toggle('show')">Show Element</button>
                        <div class="dynamic-content" id="css-descendant-content">âœ“ Found via descendant selector</div>
                    </div>
                </div>
            </div>

            <!-- XPATH SECTION -->
            <div class="card">
                <h3>XPath Selectors</h3>
                <div class="elements-grid">
                    <div class="element-card">
                        <div class="element-label">XPath by Text</div>
                        <button class="xpath-button">Find By Text</button>
                        <div class="dynamic-content" id="xpath-text-content">âœ“ Found using XPath text()</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">XPath by Attribute</div>
                        <input type="text" placeholder="XPath Attr Input" data-xpath-attr="test-value">
                        <button onclick="document.getElementById('xpath-attr-content').classList.toggle('show')">Verify Input</button>
                        <div class="dynamic-content" id="xpath-attr-content">âœ“ Input found by XPath attribute</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">XPath by Position</div>
                        <button>Button 1</button>
                        <button>Button 2</button>
                        <button id="button-position-3">Button 3</button>
                        <button onclick="document.getElementById('xpath-position-content').classList.toggle('show')">Show Position 3</button>
                        <div class="dynamic-content" id="xpath-position-content">âœ“ Found Button 3 by position</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">XPath Complex</div>
                        <div class="complex-xpath-container">
                            <span data-level="1">Level 1</span>
                            <span data-level="2">Level 2</span>
                        </div>
                        <button onclick="document.getElementById('xpath-complex-content').classList.toggle('show')">Find Complex</button>
                        <div class="dynamic-content" id="xpath-complex-content">âœ“ Complex XPath executed</div>
                    </div>
                </div>
            </div>

            <!-- ROLE-BASED SELECTORS SECTION -->
            <div class="card">
                <h3>Role-Based Selectors (Accessibility)</h3>
                <div class="elements-grid">
                    <div class="element-card">
                        <div class="element-label">Button Role</div>
                        <button role="button" id="role-button">Click Me (Button Role)</button>
                        <div class="dynamic-content" id="role-button-content">âœ“ Found by button role</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Link Role</div>
                        <a href="#" role="link" id="role-link">Click Link</a>
                        <div class="dynamic-content" id="role-link-content">âœ“ Found by link role</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Textbox Role</div>
                        <input type="text" role="textbox" id="role-textbox" placeholder="Enter text...">
                        <div class="dynamic-content" id="role-textbox-content">âœ“ Found by textbox role</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Checkbox Role</div>
                        <input type="checkbox" role="checkbox" id="role-checkbox">
                        <label for="role-checkbox">Accept Terms</label>
                        <div class="dynamic-content" id="role-checkbox-content">âœ“ Found by checkbox role</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Combobox Role</div>
                        <select role="combobox" id="role-combobox">
                            <option>Select an option</option>
                            <option>Option 1</option>
                            <option>Option 2</option>
                        </select>
                        <div class="dynamic-content" id="role-combobox-content">âœ“ Found by combobox role</div>
                    </div>
                </div>
            </div>

            <!-- TEXT-BASED SELECTORS SECTION -->
            <div class="card">
                <h3>Text-Based Selectors</h3>
                <div class="elements-grid">
                    <div class="element-card">
                        <div class="element-label">Button by Exact Text</div>
                        <button id="text-exact">Exact Text Button</button>
                        <div class="dynamic-content" id="text-exact-content">âœ“ Found by exact text match</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Button by Partial Text</div>
                        <button id="text-partial">This Button Has Partial Text</button>
                        <div class="dynamic-content" id="text-partial-content">âœ“ Found by partial text match</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Label by Text</div>
                        <input type="text" id="text-input">
                        <label for="text-input">Username Field</label>
                        <div class="dynamic-content" id="text-label-content">âœ“ Found label by text</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Heading by Text</div>
                        <h3>Find This Heading</h3>
                        <button onclick="document.getElementById('text-heading-content').classList.toggle('show')">Search for Heading</button>
                        <div class="dynamic-content" id="text-heading-content">âœ“ Found heading by text</div>
                    </div>
                </div>
            </div>

            <!-- DYNAMIC ELEMENTS SECTION -->
            <div class="card">
                <h3>Dynamic Elements (Auto-waiting Scenarios)</h3>
                <div class="elements-grid">
                    <div class="element-card">
                        <div class="element-label">Element Appears After Delay</div>
                        <button onclick="showDynamicElement('delayed-element')">Trigger Element</button>
                        <div id="delayed-element" class="delayed-message">âœ“ I appeared after a delay!</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Element Changes State</div>
                        <button id="state-button" onclick="changeState(this)">Not Clicked</button>
                        <div id="state-content" class="dynamic-content">âœ“ State changed to clicked</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Element Becomes Enabled</div>
                        <input type="text" id="dynamic-input" placeholder="Type here...">
                        <button id="dynamic-button" disabled>Submit (Initially Disabled)</button>
                        <div id="dynamic-button-content" class="dynamic-content">âœ“ Button is now enabled</div>
                    </div>

                    <div class="element-card">
                        <div class="element-label">List Appends Items</div>
                        <button onclick="addListItem()">Add Item</button>
                        <ul id="dynamic-list" class="plain-list spaced">
                            <li class="list-item">Item 1</li>
                        </ul>
                    </div>

                    <div class="element-card">
                        <div class="element-label">Modal Appears</div>
                        <button onclick="showModal()">Open Modal</button>
                        <div id="modal-overlay" class="modal-overlay">
                            <div class="modal-card">
                                <h3>Modal Content</h3>
                                <p>This modal appears dynamically</p>
                                <button onclick="closeModal()">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API call helpers
        async function callApi(buttonId, responseId, url) {
            const button = document.getElementById(buttonId);
            const box = document.getElementById(responseId);
            if (!button || !box) return;
            box.classList.add('show');
            box.classList.remove('error');
            box.textContent = 'â³ Loading...';
            try {
                const resp = await fetch(url, { credentials: 'include' });
                const text = await resp.text();
                let parsed;
                try { parsed = JSON.parse(text); } catch (e) { parsed = text; }
                box.textContent = typeof parsed === 'string' ? parsed : JSON.stringify(parsed, null, 2);
                if (!resp.ok) {
                    box.classList.add('error');
                }
            } catch (err) {
                box.textContent = `Error: ${err.message}`;
                box.classList.add('error');
            }
        }

        // Basic auth state probe using /auth/status
        (async () => {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const authUserLabel = document.getElementById('authUserLabel');
            const authStatusLabel = document.getElementById('authStatusLabel');
            const authSection = document.getElementById('authSection');

            try {
                const resp = await fetch('/auth/status', { credentials: 'include' });
                const data = await resp.json();
                if (data.authenticated) {
                    const displayName = data.name || data.userId || 'Authenticated user';
                    logoutBtn.classList.remove('hidden');
                    loginBtn.classList.add('hidden');
                    authUserLabel.textContent = displayName;
                    authStatusLabel.textContent = 'You are logged in';
                    authSection.innerHTML = `<strong>âœ… Logged in as ${displayName}</strong>`;
                } else {
                    logoutBtn.classList.add('hidden');
                    loginBtn.classList.remove('hidden');
                    authUserLabel.textContent = 'Welcome';
                    authStatusLabel.textContent = 'You are not logged in';
                    authSection.innerHTML = `
                        <p><strong>Demo Credentials</strong></p>
                        <p>ðŸ‘¤ user1 / password1 (requires 2FA)</p>
                        <p>ðŸ‘¤ user2 / password2 (no 2FA)</p>
                        <p class="note-text">Note: 2FA codes are logged to the server console for testing</p>
                    `;
                }
            } catch (e) {
                logoutBtn.classList.add('hidden');
                loginBtn.classList.remove('hidden');
                authUserLabel.textContent = 'Welcome';
                authStatusLabel.textContent = 'You are not logged in';
                authSection.innerHTML = `
                    <p><strong>Demo Credentials</strong></p>
                    <p>ðŸ‘¤ user1 / password1 (requires 2FA)</p>
                    <p>ðŸ‘¤ user2 / password2 (no 2FA)</p>
                    <p class="note-text">Note: 2FA codes are logged to the server console for testing</p>
                `;
            }
        })();

        // Wire API try buttons
        document.getElementById('btn-api-data').addEventListener('click', () => callApi('btn-api-data', 'resp-api-data', '/api/data'));
        document.getElementById('btn-api-unreliable').addEventListener('click', () => callApi('btn-api-unreliable', 'resp-api-unreliable', '/api/unreliable'));
        document.getElementById('btn-api-slow').addEventListener('click', () => callApi('btn-api-slow', 'resp-api-slow', '/api/slow'));

        // CSS Selector Click Handlers
        document.getElementById('css-id-button').addEventListener('click', function() {
            document.getElementById('css-id-content').classList.toggle('show');
        });

        document.querySelector('.css-class-button').addEventListener('click', function() {
            document.getElementById('css-class-content').classList.toggle('show');
        });

        document.querySelector('[data-testid="css-attr-button"]').addEventListener('click', function() {
            document.getElementById('css-attr-content').classList.toggle('show');
        });

        // XPath Button Handlers
        document.querySelector('.xpath-button').addEventListener('click', function() {
            document.getElementById('xpath-text-content').classList.toggle('show');
        });

        // Role-Based Handlers
        document.getElementById('role-button').addEventListener('click', function() {
            document.getElementById('role-button-content').classList.toggle('show');
        });

        document.getElementById('role-link').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('role-link-content').classList.toggle('show');
        });

        document.getElementById('role-textbox').addEventListener('click', function() {
            document.getElementById('role-textbox-content').classList.toggle('show');
        });

        document.getElementById('role-checkbox').addEventListener('change', function() {
            document.getElementById('role-checkbox-content').classList.toggle('show');
        });

        document.getElementById('role-combobox').addEventListener('change', function() {
            document.getElementById('role-combobox-content').classList.toggle('show');
        });

        // Text-Based Handlers
        document.getElementById('text-exact').addEventListener('click', function() {
            document.getElementById('text-exact-content').classList.toggle('show');
        });

        document.getElementById('text-partial').addEventListener('click', function() {
            document.getElementById('text-partial-content').classList.toggle('show');
        });

        document.getElementById('text-input').addEventListener('click', function() {
            document.getElementById('text-label-content').classList.toggle('show');
        });

        // Dynamic Elements Functions
        function showDynamicElement(elementId) {
            setTimeout(() => {
                document.getElementById(elementId).style.display = 'block';
            }, 1500);
        }

        function changeState(button) {
            button.textContent = 'Clicked';
            button.style.background = '#48bb78';
            document.getElementById('state-content').classList.add('show');
        }

        // Enable button when input has text
        document.getElementById('dynamic-input').addEventListener('input', function() {
            const button = document.getElementById('dynamic-button');
            if (this.value.length > 0) {
                button.disabled = false;
                document.getElementById('dynamic-button-content').classList.add('show');
            } else {
                button.disabled = true;
                document.getElementById('dynamic-button-content').classList.remove('show');
            }
        });

        let itemCount = 1;
        function addListItem() {
            itemCount++;
            const list = document.getElementById('dynamic-list');
            const li = document.createElement('li');
            li.textContent = `Item ${itemCount}`;
            li.classList.add('list-item');
            list.appendChild(li);
        }

        function showModal() {
            document.getElementById('modal-overlay').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }
    </script>
</body>
</html>
